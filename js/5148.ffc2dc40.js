"use strict";(self["webpackChunkresep_bunda"]=self["webpackChunkresep_bunda"]||[]).push([[5148],{5148:(e,n,a)=>{a.r(n),a.d(n,{default:()=>b});var r=a(3144),t=a(124),u=a(8534),l=(a(1249),a(3210),a(8309),a(6252)),o=a(2262),i=a(3577),c=a(7208),s=a(6100),d=a(316),f=a(6708),p=a(6693),m=a(5856),v=function(e){return(0,l.dD)("data-v-0f034451"),e=e(),(0,l.Cn)(),e},g={class:"profile-picture-container"},U=["src"],k=v((function(){return(0,l._)("label",{for:"file-upload",class:"upload-button"},"Ganti Foto Profil",-1)}));const w={__name:"HalamanSetting",setup:function(e){var n=a(6706),v=(0,s.ad)(m.H),w=(0,f.cF)(m.H),h=(0,o.iH)(""),S=(0,o.iH)(""),b=(0,o.iH)(""),W=(0,o.iH)(""),_=(0,o.iH)(""),x=(0,o.iH)(""),V=(0,o.iH)(n),H=(0,o.iH)([]),Q=(0,o.iH)(""),Z=(0,o.iH)(""),R=(0,o.iH)(!1),P=(0,o.iH)({isOpen:!1,message:"",duration:2e3,color:"success"}),K=function(){var e=(0,u.Z)((0,t.Z)().mark((function e(){var a,r,u,l;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=(0,d.v0)(m.H),r=a.currentUser,r){e.next=5;break}return E("Pengguna tidak terautentikasi","danger"),e.abrupt("return");case 5:return e.prev=5,e.next=8,(0,s.QT)((0,s.JU)(v,"users",r.uid));case 8:u=e.sent,u.exists()?(l=u.data(),h.value=l.fullName||"",S.value=l.email||"",b.value=l.username||"",W.value=l.kelas||"",_.value=l.role||"",V.value=l.profilePicture||n,x.value=l.qrCode||"",Q.value=l.nisn||"",Z.value=l.schoolName||"",R.value=!!l.kelas):E("Data pengguna tidak ditemukan","danger"),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](5),console.error("Error fetching user data:",e.t0),E("Terjadi kesalahan saat mengambil data pengguna","danger");case 16:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=(0,u.Z)((0,t.Z)().mark((function e(){var n;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.PL)((0,s.hJ)(v,"kelas"));case 2:n=e.sent,H.value=n.docs.map((function(e){return(0,r.Z)({id:e.id},e.data())}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=(0,u.Z)((0,t.Z)().mark((function e(){var n;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.mR.checkPermission({force:!0});case 3:return e.next=5,p.mR.hideBackground();case 5:return e.next=7,p.mR.startScan();case 7:n=e.sent,n.hasContent&&(x.value=n.content,E("QR Code berhasil dipindai","success")),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](0),console.error("Error scanning QR code:",e.t0),E("Error scanning QR code","danger");case 15:return e.prev=15,p.mR.showBackground(),p.mR.stopScan(),e.finish(15);case 19:case"end":return e.stop()}}),e,null,[[0,11,15,19]])})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=(0,u.Z)((0,t.Z)().mark((function e(){var n,a;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=(0,d.v0)(m.H),a=n.currentUser,a){e.next=5;break}return E("Pengguna tidak terautentikasi","danger"),e.abrupt("return");case 5:if(""!==x.value.trim()){e.next=8;break}return E("Kode QR tidak boleh kosong","danger"),e.abrupt("return");case 8:return e.prev=8,e.next=11,(0,s.r7)((0,s.JU)(v,"users",a.uid),{qrCode:x.value});case 11:E("Kode QR berhasil didaftarkan","success"),e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](8),console.error("Error registering QR code:",e.t0),E("Gagal mendaftarkan kode QR","danger");case 18:case"end":return e.stop()}}),e,null,[[8,14]])})));return function(){return e.apply(this,arguments)}}(),G=function(){var e=(0,u.Z)((0,t.Z)().mark((function e(){var n,a;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=(0,d.v0)(m.H),a=n.currentUser,a){e.next=5;break}return E("Pengguna tidak terautentikasi","danger"),e.abrupt("return");case 5:return e.prev=5,e.next=8,(0,s.r7)((0,s.JU)(v,"users",a.uid),{fullName:h.value,email:S.value,username:b.value,kelas:W.value,profilePicture:V.value,nisn:Q.value,schoolName:Z.value});case 8:E("Informasi pengguna berhasil diperbarui","success"),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](5),console.error("Error updating user info:",e.t0),E("Gagal memperbarui informasi pengguna","danger");case 15:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=(0,u.Z)((0,t.Z)().mark((function e(n){var a,r,u,l,o;return(0,t.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=n.target.files[0],a){e.next=3;break}return e.abrupt("return");case 3:if(r=(0,d.v0)(m.H),u=r.currentUser,u){e.next=8;break}return E("Pengguna tidak terautentikasi","danger"),e.abrupt("return");case 8:return l=(0,f.iH)(w,"profile_pictures/".concat(u.uid)),e.prev=9,e.next=12,(0,f.KV)(l,a);case 12:return e.next=14,(0,f.Jt)(l);case 14:return o=e.sent,V.value=o,E("Foto profil berhasil diunggah","success"),e.next=19,(0,s.r7)((0,s.JU)(v,"users",u.uid),{profilePicture:o});case 19:e.next=25;break;case 21:e.prev=21,e.t0=e["catch"](9),console.error("Error uploading profile picture:",e.t0),E("Gagal mengunggah foto profil","danger");case 25:case"end":return e.stop()}}),e,null,[[9,21]])})));return function(n){return e.apply(this,arguments)}}(),$=function(e){R.value&&(E("Tidak bisa mengubah kelas. Hubungi admin.","danger"),W.value=e.target.value)},E=function(e,n){P.value={isOpen:!0,message:e,duration:2e3,color:n}},J=function(e){K(),y(),e.target.complete()};return(0,l.bv)((function(){K(),y()})),function(e,a){return(0,l.wg)(),(0,l.j4)((0,o.SU)(c._i),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Gu),{mode:"ios"},{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.sr),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.wd),null,{default:(0,l.w5)((function(){return[(0,l.Uk)("Pengaturan")]})),_:1}),(0,l.Wm)((0,o.SU)(c.oU),{slot:"start","default-href":"/"})]})),_:1})]})),_:1}),(0,l.Wm)((0,o.SU)(c.W2),{fullscreen:!0},{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.nJ),{slot:"fixed",onIonRefresh:a[0]||(a[0]=function(e){return J(e)})},{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Wo))]})),_:1}),(0,l.Wm)((0,o.SU)(c.W2),{class:"ion-padding"},{default:(0,l.w5)((function(){return[(0,l._)("div",g,[(0,l._)("img",{src:V.value||(0,o.SU)(n),alt:"Profile Picture",class:"profile-picture"},null,8,U),k,(0,l._)("input",{id:"file-upload",type:"file",onChange:N,accept:"image/*"},null,32)]),(0,l.Wm)((0,o.SU)(c.Ie),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Q$),{position:"floating"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Nama Lengkap")]})),_:1}),(0,l.Wm)((0,o.SU)(c.pK),{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=function(e){return h.value=e})},null,8,["modelValue"])]})),_:1}),(0,l.Wm)((0,o.SU)(c.Ie),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Q$),{position:"floating"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Email")]})),_:1}),(0,l.Wm)((0,o.SU)(c.pK),{modelValue:S.value,"onUpdate:modelValue":a[2]||(a[2]=function(e){return S.value=e}),type:"email"},null,8,["modelValue"])]})),_:1}),(0,l.Wm)((0,o.SU)(c.Ie),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Q$),{position:"floating"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Username")]})),_:1}),(0,l.Wm)((0,o.SU)(c.pK),{modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=function(e){return b.value=e})},null,8,["modelValue"])]})),_:1}),(0,l.Wm)((0,o.SU)(c.Ie),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Q$),{position:"floating"},{default:(0,l.w5)((function(){return[(0,l.Uk)("NISN")]})),_:1}),(0,l.Wm)((0,o.SU)(c.pK),{modelValue:Q.value,"onUpdate:modelValue":a[4]||(a[4]=function(e){return Q.value=e})},null,8,["modelValue"])]})),_:1}),(0,l.Wm)((0,o.SU)(c.Ie),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Q$),{position:"floating"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Nama Sekolah")]})),_:1}),(0,l.Wm)((0,o.SU)(c.pK),{modelValue:Z.value,"onUpdate:modelValue":a[5]||(a[5]=function(e){return Z.value=e})},null,8,["modelValue"])]})),_:1}),(0,l.Wm)((0,o.SU)(c.Ie),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Q$),{position:"floating"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Kelas")]})),_:1}),(0,l.Wm)((0,o.SU)(c.t9),{modelValue:W.value,"onUpdate:modelValue":a[6]||(a[6]=function(e){return W.value=e}),placeholder:"Pilih Kelas",disabled:R.value,onIonChange:$},{default:(0,l.w5)((function(){return[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(H.value,(function(e){return(0,l.wg)(),(0,l.j4)((0,o.SU)(c.n0),{key:e.id,value:e.id},{default:(0,l.w5)((function(){return[(0,l.Uk)((0,i.zw)(e.name),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["modelValue","disabled"])]})),_:1}),(0,l.Wm)((0,o.SU)(c.Ie),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Q$),{position:"floating"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Role")]})),_:1}),(0,l.Wm)((0,o.SU)(c.pK),{modelValue:_.value,"onUpdate:modelValue":a[7]||(a[7]=function(e){return _.value=e}),readonly:""},null,8,["modelValue"])]})),_:1}),(0,l.Wm)((0,o.SU)(c.YG),{style:{color:"white"},onClick:G,expand:"block"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Perbarui Informasi Pengguna")]})),_:1}),(0,l.Wm)((0,o.SU)(c.Ie),null,{default:(0,l.w5)((function(){return[(0,l.Wm)((0,o.SU)(c.Q$),{position:"floating"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Kode QR")]})),_:1}),(0,l.Wm)((0,o.SU)(c.pK),{modelValue:x.value,"onUpdate:modelValue":a[8]||(a[8]=function(e){return x.value=e}),placeholder:"Hasil scan QR Code",readonly:""},null,8,["modelValue"])]})),_:1}),(0,l.Wm)((0,o.SU)(c.YG),{style:{color:"white"},onClick:C,expand:"block"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Scan QR Code")]})),_:1}),(0,l.Wm)((0,o.SU)(c.YG),{style:{color:"white"},onClick:I,expand:"block"},{default:(0,l.w5)((function(){return[(0,l.Uk)("Daftarkan Kode QR")]})),_:1})]})),_:1}),(0,l.Wm)((0,o.SU)(c.jY),{class:"ion-padding"}),(0,l.Wm)((0,o.SU)(c.Px),{"is-open":P.value.isOpen,message:P.value.message,duration:P.value.duration,color:P.value.color,onDidDismiss:a[9]||(a[9]=function(){return P.value.isOpen=!1})},null,8,["is-open","message","duration","color"])]})),_:1})]})),_:1})}}};var h=a(3744);const S=(0,h.Z)(w,[["__scopeId","data-v-0f034451"]]),b=S},6706:(e,n,a)=>{e.exports=a.p+"img/avatar.40910a76.png"}}]);
//# sourceMappingURL=5148.ffc2dc40.js.map